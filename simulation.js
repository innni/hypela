window.Helper=function(){function e(){}e.getRandomInt=function(e,t){return Math.floor(Math.random()*(t-e))+e};e.map=function(e,t,n,r,i){return r+(i-r)*((e-t)/(n-t))};return e}();window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();window.Vector=function(){function e(e,t){this.x=e||0;this.y=t||0}e.add=function(t,n){return new e(t.x+n.x,t.y+n.y)};e.subtract=function(t,n){return new e(t.x-n.x,t.y-n.y)};e.distance=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))};e.prototype={constructor:e,add:function(t){if(t instanceof e){this.x+=t.x;this.y+=t.y}else{this.x+=t;this.y+=t}},subtract:function(t){if(t instanceof e){this.x-=t.x;this.y-=t.y}else{this.x-=t;this.y-=t}},multiply:function(t){if(t instanceof e){this.x*=t.x;this.y*=t.y}else{this.x*=t;this.y*=t}},divide:function(t){if(t instanceof e){this.x/=t.x;this.y/=t.y}else{this.x/=t;this.y/=t}},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var e=this.magnitude();if(e!==0){this.divide(e)}},heading:function(){return Math.atan2(this.y,this.x)},limit:function(e){var t=this.magnitude();if(t>e){this.normalize();this.multiply(e)}}};return e}();window.Boid=function(){function e(e,t,n){this.location=new Vector(e,t);this.acceleration=new Vector(0,0);this.velocity=new Vector(Helper.getRandomInt(-1,1),Helper.getRandomInt(-1,1));this.settings=n||{};this.show_connections=n.show_connections||true;this.r=n.r||3;this.maxspeed=n.maxspeed||2;this.maxforce=n.maxforce||.5;this.perchSite=n.perchSite||[h-100,h-50];this.laziness_level=n.laziness_level||.7;this.min_perch=n.min_perch||1;this.max_perch=n.max_perch||100;this.perching=n.perching||false;this.perchTimer=n.perchTimer||100;this.separation_multiple=n.separation||.2;this.cohesion_multiple=n.cohesion||2;this.alignment_multiple=n.alignment||1;this.separation_neighbor_dist=(n.separation_neighbor_dis||10)*10;this.cohesion_neighbor_dist=n.cohesion_neighbor_dis||200;this.alignment_neighbor_dist=n.alignment_neighbor_dis||200}e.prototype={constructor:e,update:function(){if(this.perching){this.perchTimer--;if(this.perchTimer<0){this.perching=false}}else{this.velocity.add(this.acceleration);this.velocity.limit(this.maxspeed);this.location.add(this.velocity);this.acceleration.multiply(0)}},applyForce:function(e){this.acceleration.add(e)},tired:function(){var e=Math.random();if(e<this.laziness_level){return false}else{return true}},seek:function(e){var t=Vector.subtract(e,this.location);t.normalize();t.multiply(this.maxspeed);var n=Vector.subtract(t,this.velocity);n.limit(this.maxforce);return n},arrive:function(e){var t=Vector.subtract(e,this.location);var n=t.magnitude();t.normalize();if(n<100){var r=Helper.map(n,0,100,0,this.maxspeed);t.multiply(r)}else{t.multiply(this.maxspeed)}var i=Vector.subtract(t,this.velocity);i.limit(this.maxforce);return i},align:function(e){var t=new Vector;var n=0;for(var r=0;r<e.length;r++){if(e[r].perching==false){var i=Vector.distance(this.location,e[r].location);t.add(e[r].velocity);n++}}if(n>0){t.divide(n);t.normalize();t.multiply(this.maxspeed);var s=Vector.subtract(t,this.velocity);s.limit(this.maxforce);return s}else{return new Vector(0,0)}},cohesion:function(e){var t=new Vector;var n=0;for(var r=0;r<e.length;r++){if(e[r].perching==false){var i=Vector.distance(this.location,e[r].location);t.add(e[r].location);n++}}if(n>0){t.divide(n);return this.seek(t)}else{return new Vector(0,0)}},separate:function(e){var t=new Vector;var n=0;for(var r=0;r<e.length;r++){var i=Vector.distance(this.location,e[r].location);if(i>0&&i<this.separation_neighbor_dist){var s=Vector.subtract(this.location,e[r].location);s.normalize();s.divide(i);t.add(s);n++}}if(n>0){t.divide(n);t.normalize();t.multiply(this.maxspeed);var o=Vector.subtract(t,this.velocity);o.limit(this.maxforce)}return t},borders:function(){var e=20;var t=this.tired();if(this.onPerchSite()&&t){this.perching=true}else{if(this.location.x<-e)this.location.x+=5;if(this.location.x>w+e)this.location.x-=5;if(this.location.y>h+e)this.location.y-=5;if(this.location.y<-e)this.location.y+=5}},onPerchSite:function(){for(var e=0;e<this.perchSite.length;e++){if(this.location.y>this.perchSite[e]-2&&this.location.y<this.perchSite[e]+2)return true}return false},borders2:function(){var e=20;var t=this.tired();if(this.location.y>this.perchSite-2&&this.location.y<this.perchSite+2&&t){this.perching=true}else{if(this.location.x<-this.r)this.location.x=w+this.r;if(this.location.y<-this.r)this.location.y=h+this.r;if(this.location.x>w+this.r)this.location.x=-this.r;if(this.location.y>h+this.r)this.location.y=-this.r}},render:function(){var e=this.velocity.heading()+Math.PI/2;context.stroke();context.save();context.translate(this.location.x,this.location.y);context.rotate(e);if(this.settings.boid_shape){this.settings.boid_shape()}else{this.default_boid_shape()}context.restore()},default_boid_shape:function(){var e=5;context.fillStyle="#636570";context.beginPath();context.arc(0,0,e,0,2*Math.PI,false);context.closePath();context.fill()},flock:function(e){var t=this.separate(e);var n=this.align(e);var r=this.cohesion(e);t.multiply(this.separation_multiple);n.multiply(this.alignment_multiple);r.multiply(this.cohesion_multiple);this.applyForce(t);this.applyForce(n);this.applyForce(r)},run:function(e){if(this.perching){this.perchTimer--;if(this.perchTimer<0){this.perching=false;this.perchTimer=Helper.getRandomInt(this.min_perch,this.max_perch)}}else{this.flock(e);this.update();this.borders()}}};return e}();window.Flock=function(){function e(e,t){this.boids=new Array;this.boid_settings=e||{};this.flock_settings=t||{};this.population=t.population||20;this.world_x=t.world_width||window.innerWidth;this.world_y=t.world_height||window.innerHeight;this.world_centre=new Vector(this.world_width/2,this.world_height/2)}e.prototype={constructor:e,addBoid:function(e){this.boids.push(e)},setup:function(){for(var e=0;e<this.population;e++){this.boid_settings.separation_neighbor_dis=Helper.getRandomInt(3,14);this.boid_settings.maxspeed=Helper.getRandomInt(5,6);this.addBoid(new Boid(Helper.getRandomInt(0,this.world_x),Helper.getRandomInt(0,this.world_y),this.boid_settings))}},default_world:function(){context.beginPath();context.fillStyle="#395a6e";context.fillRect(0,this.world_y-100,this.world_x,2);context.fillRect(0,this.world_y-50,this.world_x,2);context.closePath()},run:function(){for(var e=0;e<this.boids.length;e++){this.boids[e].run(this.boids)}context.clearRect(0,0,w,h);if(this.flock_settings.world){this.flock_settings.world()}else{this.default_world()}for(var e=0;e<this.boids.length;e++){this.boids[e].render();context.beginPath();if(typeof this.boids[e+1]!="undefined"){context.moveTo(this.boids[e].location.x,this.boids[e].location.y);context.lineTo(this.boids[e+1].location.x,this.boids[e+1].location.y)}if(typeof this.boids[e+2]!="undefined"){context.moveTo(this.boids[e].location.x,this.boids[e].location.y);context.lineTo(this.boids[e+2].location.x,this.boids[e+2].location.y)}context.lineWidth=.06;context.strokeStyle="gray";context.closePath();context.stroke()}}};return e}();var w=window.innerWidth;var h=window.innerHeight;var context=document.getCSSCanvasContext("2d","simulation",w,h);var flock_settings={population:20};var boid_settings={laziness_level:.1};var f=new Flock(boid_settings,flock_settings);f.setup();(function e(){f.run();requestAnimFrame(e)})()